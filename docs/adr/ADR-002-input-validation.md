# ADR-002: Безопасная валидация входных данных и загрузок

## Контекст
Загрузка файлов и пути ввода могут быть использованы для исчерпания ресурсов или обхода директорий. Нам нужна строгая валидация: ограничения размера, таймауты, проверка магических байтов, канонизация, отклонение символических ссылок и именование файлов UUID.

## Решение
- Ввести эндпоинт загрузки с:
  - Максимальной длиной контента (например, 2 МБ), применяемой на уровне сервера.
  - Защитой времени чтения для прерывания слишком больших потоков.
  - Проверкой магических байтов для поддерживаемых MIME-типов (например, PNG, JPEG, PDF).
  - Канонизацией пути назначения под выделенную директорию `uploads/`; отклонение обхода и символических ссылок.
  - Хранением файлов с именами UUID v4 и безопасным расширением, полученным из проверенного типа.
  - Отклонением неизвестных/неоднозначных типов.

## Последствия
- Снижает риск DoS, обхода директорий и подмены типа контента.
- Требует дополнительных негативных тестов и утилит.

## Ссылки
- NFR: см. `docs/security-nfr/NFR.md`
- P04 F#/R#: F#-file-uploads, R#-validate-magic-bytes, R#-size-limits
- Тесты: `tests/test_uploads.py`
