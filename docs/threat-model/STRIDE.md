## STRIDE анализ

### Легенда
- Target: поток данных (Fx) или элемент
- STRIDE: категория угрозы (S/T/R/I/D/E)
- Control: основной контроль/смягчение
- NFR: ссылка на NFR
- Evidence: проверка/доказательства (тесты, линтеры, сканеры, CI)

| Target | STRIDE | Threat | Control | NFR | Evidence |
|--------|--------|--------|---------|-----|----------|
| F1 User → Session manager | S, T | Подмена клиента, перехват учетных данных | HTTPS/TLS 1.2+, HSTS, rate-limit, блок по IP/UA | NFR-OPENAPI, NFR-DTO | e2e, OpenAPI линт, `tests/test_errors.py` (422) |
| F1 User → Session manager | R, I | Инъекции в поля логина | Валидация/нормализация DTO, ограничение длины | NFR-DTO | BDD: NFR-DTO, `tests/test_errors.py` |
| F2 Session manager → User | I | Утечка PII/секретов в ответах | Маскирование, не возвращать `password` | NFR-PII, NFR-API-ERR | BDD: NFR-PII, `tests/test_errors.py` |
| F3 User → CRUD Tasks | R, I | Инъекции/нарушение целостности данных задач | Валидация DTO, строгие схемы OpenAPI | NFR-DTO, NFR-OPENAPI | BDD: NFR-DTO, OpenAPI линт |
| F5 CRUD Tasks → Session manager | E | Ошибочная эскалация привилегий (неверная проверка прав) | Централизованная проверка доступа, RBAC | NFR-API-ERR | Unit/e2e на RBAC, обозримые коды ошибок |
| F6 Session manager ↔ User DB | T, I | Перехват/подмена запросов к БД | Изолированная сеть, TLS к БД (если поддерж.), минимальные права | NFR-SCA | IaC ревью, SCA, DB конфигурации |
| F7 CRUD Tasks ↔ Task DB | I, D | Инъекции в запросы к БД, повреждение данных | Параметризованные запросы/ORM, миграции с проверками | NFR-SCA | CI: линтер/ORM правила, SCA, e2e CRUD |
| F10 Logger ↔ Logs | I, D | Порча/манипуляция логами | Неизменяемое хранение (WORM/append-only), контроль доступа | NFR-LOG | Проверка лог-политики, ручная валидация |
| F11 Session manager → Logger | I | Логи раскрывают секреты/PII | Маскирование секретов, редактирование чувств. полей | NFR-LOG, NFR-PII | Просмотр логов, e2e |
| F12 CRUD Tasks → Logger | R | Спуфинг источника события | Подпись/метки контекста (request_id, service_id) | NFR-LOG | Логи содержат `request_id` |
| F13 Logger → Admin | I, E | Неконтролируемый доступ к логам (эскалация) | RBAC на чтение логов, аудит обращений | NFR-LOG | Ручные проверки прав, e2e |

### Краткие обоснования
- Валидация DTO (NFR-DTO) и единый контракт ошибок (NFR-API-ERR) уменьшают риск инъекций и улучшают предсказуемость обработки ошибок.
- Маскирование (NFR-PII) и политика логирования (NFR-LOG) предотвращают утечки чувствительных данных через ответы и логи.
- Линт/синхронизация OpenAPI (NFR-OPENAPI) уменьшает расхождения контракта, снижая вероятность некорректной обработки входных данных.
- Контроль зависимостей (NFR-SCA) снижает риски уязвимостей в ORM/клиентах БД и инфраструктурных библиотеках.

### Примечания
- Потоки F1, F2, F3, F4, F8, F9, F13 проходят по HTTPS; шифрование канала — базовый контроль для S/T.
- Для RBAC предполагается централизованная проверка через `Session manager` перед доступом к данным.
- Для `Logs` рекомендуется политики неизменяемости либо централизованный стэк логирования с ролевым доступом.
